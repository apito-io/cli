# Apito CLI

üöÄ **Apito CLI** is a powerful command-line tool for managing projects, functions, and deployments on the Apito platform. It provides a seamless development experience from local development to cloud deployment.

## üì¶ Installation

### Quick Install (Linux & macOS)

```bash
curl -fsSL https://get.apito.io/install.sh | bash
```

### Manual Install

```bash
# Download the installer
wget -O install.sh https://get.apito.io/install.sh

# Make it executable
chmod +x install.sh

# Run the installer
./install.sh
```

### Verify Installation

```bash
apito --version
```

## üéØ Getting Started

### 0. Initialize Apito CLI (First Time Setup)

```bash
apito init
```

This command will:

- Create the `~/.apito` directory if it doesn't exist
- Create `~/.apito/bin/.env` with default system configuration
- Validate database and environment settings
- Check port availability (5050, 4000) and optionally free them
- Guide you through any missing configuration

### 1. Create Your First Project

```bash
apito create project -n my-awesome-app
```

This interactive command will:

- Create a new project directory
- Set up system and project databases
- Download the latest Apito engine
- Configure your project settings

### 2. Start Apito Engine and Console

```bash
apito start
```

This command will:

- Download the latest Apito engine from [GitHub releases](https://github.com/apito-io/engine/releases) to `~/.apito/bin/engine`
- Download the latest console from [GitHub releases](https://github.com/apito-io/console/releases) to `~/.apito/console`
- Install and configure Caddy web server to `~/.apito/bin/caddy`
- Start the engine on port 5050
- Serve the console on port 4000
- Manage processes with PID files and logs

### 3. Deploy to Apito Cloud

```bash
apito deploy -p my-awesome-app
```

## üìö Command Reference

### üîß **System Management**

#### `init` - Initialize Apito CLI System

Initializes and validates the Apito CLI system configuration.

**Usage:**

```bash
apito init
```

**Features:**

- Creates `~/.apito` directory if it doesn't exist
- Sets up system configuration file with default values
- Validates system database configuration
- Checks mandatory environment variables (ENVIRONMENT, CORS_ORIGIN, COOKIE_DOMAIN, BRANKA_KEY)
- Validates database connection settings (host, port, user, password)
- Checks port availability (5050, 4000)
- Interactive configuration prompts for missing settings

**What it checks:**

- System database engine configuration (defaults to "embed")
- Database connection parameters (host, port, user, password, database name)
- Environment settings (local, development, staging, production)
- CORS and cookie domain configuration
- BRANKA_KEY generation (auto-generates if not provided)
- Port availability for Apito services (5050, 4000)

**Examples:**

```bash
# First-time setup
apito init

# Re-run to validate configuration
apito init
```

**Default Configuration:**
The init command creates a `.env` file with these default values:

```env
ENVIRONMENT=local
COOKIE_DOMAIN=localhost
CORS_ORIGIN=http://localhost:4000
PLUGIN_PATH=plugins
PUBLIC_KEY_PATH=keys/public.key
PRIVATE_KEY_PATH=keys/private.key
APITO_SYSTEM_DB_ENGINE=embed
BRANKA_KEY=<auto-generated-32-character-key>
```

**BRANKA_KEY Behavior:**

- If BRANKA_KEY is not set, a secure 32-character random key is automatically generated
- If BRANKA_KEY is already set, the existing value is preserved
- The generated key includes uppercase, lowercase, numbers, and special characters

### üîß **Project Management**

#### `create` - Create New Resources

Creates new projects, functions, or models via API calls to the Apito server.

**Usage:**

```bash
apito create <resource> [options]
```

**Resources:**

- `project` - Create a new Apito project via API
- `function` - Create a new function (coming soon)
- `model` - Create a new data model (coming soon)

**Options:**

- `--name, -n` - Name of the resource
- `--project, -p` - Project name (alternative to --name)

**Features:**

- Interactive project creation with prompts
- Database type selection with visual icons
- Automatic SYNC_TOKEN management
- HTTP API integration with authentication
- Real-time project creation on Apito server

**Database Options:**

- **Embed & SQL** (mdi:database) - Default embedded database
- **MySQL** (logos:mysql) - MySQL database
- **MariaDB** (logos:mariadb) - MariaDB database
- **PostgreSQL** (logos:postgresql) - PostgreSQL database
- **Couchbase** (logos:couchbase) - Couchbase database
- **Oracle** (logos:oracle) - Oracle database
- **Firestore** (logos:firebase) - Firebase Firestore
- **MongoDB** (logos:mongodb) - MongoDB database
- **DynamoDB** (logos:aws-dynamodb) - AWS DynamoDB

**Examples:**

```bash
# Create a new project with prompts
apito create project

# Create a project with name flag
apito create project -p my-ecommerce-app

# Create a project with name flag (alternative)
apito create project -n my-ecommerce-app
```

**SYNC_TOKEN Setup:**

The first time you create a project, you'll need to provide a SYNC_TOKEN:

1. Go to http://localhost:4000
2. Navigate to Cloud Sync option
3. Copy the generated token
4. Paste it when prompted by the CLI

The token is automatically saved and reused for future requests.

#### `list` - List Resources

Lists projects or functions.

**Usage:**

```bash
apito list [resource] [-p <project>]
```

**Resources:**

- `function` - List functions in a project
- (no resource) - List all projects

**Options:**

- `--project, -p` - Project name (required for listing functions)

**Examples:**

```bash
# List all projects
apito list

# List functions in a specific project
apito list function -p my-ecommerce-app
```

### üöÄ **Development & Execution**

#### `start` - Start Apito Engine and Console

Starts the Apito engine and console with automatic setup and downloads.

**Usage:**

```bash
apito start
```

**Options:**

- (none)

**Features:**

- **Automatic Setup**: Downloads and installs all required components
- **Port Management**: Checks port availability (5050, 4000)
- **Engine Management**: Downloads latest engine from [GitHub releases](https://github.com/apito-io/engine/releases)
- **Console Management**: Downloads latest console from [GitHub releases](https://github.com/apito-io/console/releases)
- **Caddy Integration**: Automatically installs and configures [Caddy server](https://github.com/caddyserver/caddy/releases)
- **Process Management**: Tracks running processes and prevents duplicates
- **Graceful Shutdown**: Stops all services on Ctrl+C

**What it does:**

1. **Port Check**: Verifies ports 5050 and 4000 are available
2. **Engine Download**: Downloads latest engine binary for your system architecture
3. **Process Check**: Ensures engine isn't already running
4. **Console Download**: Downloads latest console static files
5. **Caddy Installation**: Installs Caddy web server if not present
6. **Service Startup**: Starts engine and serves console with Caddy
7. **Monitoring**: Waits for interrupt signal to stop services

**Examples:**

```bash
# Start Apito with automatic setup
apito start
```

**Access URLs:**

- **Engine API**: http://localhost:5050
- **Console UI**: http://localhost:4000

**System Requirements:**

- Internet connection for downloading components
- Write permissions to `~/.apito/` directory
- Port 5050 and 4000 available

#### `stop` - Stop Services

Stops one or more Apito services.

**Usage:**

```bash
apito stop [engine|console|all]
```

**Examples:**

```bash
# Stop everything
apito stop

# Stop only engine
apito stop engine

# Stop only console
apito stop console
```

#### `restart` - Restart Services

Restarts one or more Apito services.

**Usage:**

```bash
apito restart [engine|console|all]
```

**Examples:**

```bash
apito restart
apito restart engine
apito restart console
```

#### `status` - Show Service Status and Logs

Shows whether services are running and prints the last 50 log lines.

**Usage:**

```bash
apito status [engine|console]
```

**Examples:**

```bash
apito status
apito status engine
apito status console
```

### üèóÔ∏è **Building & Packaging**

#### `build` - Build Project

Builds your project for different deployment targets.

**Usage:**

```bash
apito build <target> -p <project> [options]
```

**Targets:**

- `docker` - Build Docker image
- `zip` - Create deployment package

**Options:**

- `--project, -p` - Project name (required)
- `--tag, -t` - Docker image tag (optional, for docker builds)

**Examples:**

```bash
# Build Docker image
apito build docker -p my-ecommerce-app
apito build docker -p my-ecommerce-app -t v1.0.0

# Create ZIP package
apito build zip -p my-ecommerce-app
```

### ‚òÅÔ∏è **Deployment**

#### `deploy` - Deploy to Apito Cloud

Deploys your project to Apito Cloud platform.

**Usage:**

```bash
apito deploy -p <project>
```

**Options:**

- `--project, -p` - Project name (required)

**Examples:**

```bash
apito deploy -p my-ecommerce-app
```

**Features:**

- Interactive deployment token setup
- Automatic cloud configuration
- Real-time deployment status

#### `pack` - Package for Deployment

Packages your project for various deployment providers.

**Usage:**

```bash
apito pack <provider> -p <project> [options]
```

**Providers:**

- `apito` - Package for Apito Cloud
- `aws` - Package for AWS (coming soon)
- `google` - Package for Google Cloud (coming soon)

**Options:**

- `--project, -p` - Project name (required)
- `--tag` - Docker image tag (optional)

**Examples:**

```bash
# Package for Apito Cloud
apito pack apito -p my-ecommerce-app

# Package for AWS (when available)
apito pack aws -p my-ecommerce-app
```

### üîÑ **Updates & Maintenance**

#### `update` - Update Components

Updates Apito engine or console to the latest version.

**Usage:**

```bash
apito update <component> -p <project> [options]
```

**Components:**

- `engine` - Update the Apito engine
- `console` - Update the console interface

**Options:**

- `--project, -p` - Project name (required)
- `--version, -v` - Specific version to update to (optional)

**Examples:**

```bash
# Update engine to latest version
apito update engine -p my-ecommerce-app

# Update to specific version
apito update engine -p my-ecommerce-app -v v1.2.3

# Update console
apito update console -p my-ecommerce-app
```

### üîê **Authentication & Security**

#### `login` - Authenticate with Apito

Logs in to your Apito account using OAuth.

**Usage:**

```bash
apito login
```

**Features:**

- OAuth-based authentication
- Automatic browser opening
- Token management

#### `change-pass` - Change User Password

Changes the password for a user in your project.

**Usage:**

```bash
apito change-pass -p <project> -u <user>
```

**Options:**

- `--project, -p` - Project name (required)
- `--user, -u` - Username (required)

**Examples:**

```bash
apito change-pass -p my-ecommerce-app -u admin
```

**Features:**

- Secure password input with masking
- Password confirmation
- Minimum password length validation (6 characters)

## üóÇÔ∏è Project Structure

Apito CLI sets up the following structure:

```
~/.apito/
‚îú‚îÄ‚îÄ bin/
‚îÇ   ‚îú‚îÄ‚îÄ engine               # Engine binary
‚îÇ   ‚îú‚îÄ‚îÄ caddy                # Caddy binary
‚îÇ   ‚îî‚îÄ‚îÄ .env                 # System configuration
‚îú‚îÄ‚îÄ console/                 # Console static files
‚îú‚îÄ‚îÄ Caddyfile                # Console server config
‚îú‚îÄ‚îÄ logs/
‚îÇ   ‚îú‚îÄ‚îÄ engine.log
‚îÇ   ‚îî‚îÄ‚îÄ console.log
‚îî‚îÄ‚îÄ run/
    ‚îú‚îÄ‚îÄ engine.pid
    ‚îî‚îÄ‚îÄ console.pid
```

## ‚öôÔ∏è Configuration

### Environment Variables

The CLI manages configuration in `~/.apito/bin/.env`:

- `ENVIRONMENT` - local/development/staging/production
- `COOKIE_DOMAIN` - e.g., localhost
- `CORS_ORIGIN` - e.g., http://localhost:4000
- `BRANKA_KEY` - Generated secret key
- `APITO_SYSTEM_DB_ENGINE` - embed or external
- `SYSTEM_DB_*` - connection parameters when external
- `APITO_PROJECT_DB_ENGINE` - embedded by default
- `SERVE_PORT` - Engine port (default 5050)
- `CACHE_*`, `KV_ENGINE`, `AUTH_SERVICE_PROVIDER`, `TOKEN_TTL`
- `CADDY_PATH` - Absolute path to caddy (managed by CLI)

### Database Support

- **System Database**: boltDB (default), PostgreSQL, MySQL
- **Project Database**: PostgreSQL, MySQL, MariaDB, Firestore (alpha)

## üö® Troubleshooting

### Common Issues

**Permission Denied Error:**

```bash
# The installer will automatically handle permissions
# If you encounter issues, run with sudo:
sudo ./install.sh
```

**Project Not Found:**

```bash
# List all projects to see available ones
apito list

# Create a new project if needed
apito create project -n my-new-project
```

**Engine or Console Won't Start:**

```bash
# Check if services are running and view logs
apito status

# Stop services
apito stop

# Then try running again
apito start
```

**Deployment Fails:**

```bash
# Ensure you have a valid deploy token
# Get it from https://app.apito.io
apito deploy -p my-project
```

## üîó Useful Links

- **Apito Platform**: https://app.apito.io
- **Documentation**: https://docs.apito.io
- **GitHub**: https://github.com/apito-io/cli
- **Support**: https://github.com/apito-io/cli/issues

## ü§ù Contributing

We welcome contributions! Please see our [Contributing Guide](CONTRIBUTING.md) for details.

## üìÑ License

This project is licensed under the MIT License - see the [LICENSE](LICENSE) file for details.

---

**Happy coding with Apito! üéâ**
